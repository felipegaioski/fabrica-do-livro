import { Link } from "react-router-dom";
import { useStateContext } from "../contexts/ContextProvider";
import { useRef, useState } from "react";
import axiosClient from "../api/axios-client";

export default function Login() {
    const emailRef = useRef();
    const passwordRef = useRef();
    const [loading, setLoading] = useState(false);
    const [errors, setErrors] = useState(null);
    const {setUser, setToken} = useStateContext();

    const onSubmit = (ev) => {
        ev.preventDefault();

        const payload = {
            email: emailRef.current.value,
            password: passwordRef.current.value,
        };

        setErrors(null);
        setLoading(true);

        axiosClient.post('/login', payload).then(({data}) => {
            setUser(data.user);
            setToken(data.token);
            setLoading(false);
        }).catch(err => {
            const response = err.response;
            console.log(response);
            
            if (response && response.status === 422) {
                if (response.data.errors) {
                    setErrors(response.data.errors);
                } else {
                    setErrors({
                        email: [response.data.message],
                        // password: [response.data.message],
                    })
                }
            }
            setLoading(false);
        })
    }

    return (
        <div className="login-signup-form animated fadeInDown">
            <div className="logo">
                <svg width="180" height="60" viewBox="0 0 480 160" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M466.664 72.339c0-4.421-1.153-7.677-3.453-9.767-2.306-2.09-5.297-3.132-8.984-3.132-2.762 0-5.469.413-8.108 1.245-2.639.826-5.007 1.949-7.097 3.36l-3.225-5.53a24.63 24.63 0 014.47-2.393 40.094 40.094 0 015.019-1.708 44.353 44.353 0 015.112-1.06 32.976 32.976 0 014.748-.37c3.934 0 7.399.462 10.414 1.381 3.009.919 5.562 2.244 7.646 3.965 2.09 1.72 3.668 3.761 4.741 6.129 1.073 2.361 1.61 4.988 1.61 7.88v30.404h-25.799c-8.355 0-14.508-1.258-18.473-3.78-3.965-2.521-5.944-6.326-5.944-11.425 0-5.1 1.979-8.904 5.944-11.426 3.959-2.515 10.118-3.78 18.473-3.78h12.906v.007zm-23.493 15.205c0 5.833 3.533 8.756 10.593 8.756h12.9V78.795h-12.9c-7.066-.007-10.593 2.916-10.593 8.749zM403.549 52.996c1.967 0 3.934.167 5.895.506 1.967.339 3.853.801 5.666 1.381a29.323 29.323 0 015.069 2.164c1.566.857 2.935 1.813 4.1 2.855l-3.687 5.53c-2.522-1.904-5.081-3.378-7.695-4.42-2.609-1.042-5.42-1.566-8.429-1.566-2.214 0-4.236.351-6.08 1.06-1.844.71-3.44 1.844-4.791 3.41-1.35 1.566-2.411 3.576-3.175 6.037-.765 2.454-1.153 5.407-1.153 8.841 0 3.441.382 6.388 1.153 8.849.77 2.454 1.856 4.47 3.274 6.036a12.322 12.322 0 005.111 3.41c1.998.709 4.193 1.06 6.586 1.06 3.009 0 5.82-.524 8.428-1.566 2.609-1.042 5.174-2.516 7.696-4.42l3.687 5.53c-1.166 1.042-2.534 1.998-4.101 2.855a28.762 28.762 0 01-5.068 2.164 41.091 41.091 0 01-5.666 1.381 34.664 34.664 0 01-5.895.506c-4.359 0-8.336-.567-11.931-1.702-3.595-1.134-6.647-2.793-9.169-4.976-2.516-2.183-4.47-4.865-5.851-8.059-1.382-3.194-2.072-6.88-2.072-11.055 0-4.113.69-7.788 2.072-11.013 1.381-3.224 3.305-5.925 5.759-8.108 2.46-2.182 5.407-3.841 8.848-4.976 3.434-1.147 7.245-1.714 11.419-1.714z" fill="#104F96"></path><path d="M366.701 54.834h-12.899v47.909h12.899v-47.91z" fill="#104F96"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M343.665 61.283H332.61c-4.174 0-7.368 1.123-9.582 3.36-2.214 2.245-3.317 5.575-3.317 9.996v28.104h-12.899V74.639c0-6.265 1.979-11.13 5.944-14.601 3.958-3.472 9.655-5.204 17.092-5.204h13.817v6.45zM244.153 102.749V34.326h12.899v20.508h11.518c4.236 0 8.096.555 11.562 1.658 3.471 1.104 6.431 2.701 8.891 4.791a21.092 21.092 0 015.666 7.553c1.32 2.948 1.98 6.265 1.98 9.952 0 3.688-.66 7.005-1.98 9.952a21.04 21.04 0 01-5.666 7.553c-2.454 2.09-5.42 3.688-8.891 4.791-3.472 1.104-7.326 1.659-11.562 1.659h-24.417v.006zm24.417-6.45c2.091 0 4.008-.32 5.759-.967a11.13 11.13 0 004.514-3.09c1.258-1.412 2.244-3.224 2.947-5.438.709-2.213 1.061-4.883 1.061-8.016 0-3.132-.352-5.802-1.061-8.015-.709-2.214-1.689-4.027-2.947-5.439a11.13 11.13 0 00-4.514-3.089c-1.751-.647-3.668-.968-5.759-.968h-11.518v35.01h11.518v.013zM218.817 72.339c0-4.421-1.153-7.677-3.452-9.767-2.3-2.09-5.297-3.132-8.984-3.132a26.81 26.81 0 00-8.108 1.245c-2.639.826-5.007 1.949-7.097 3.36l-3.225-5.53a24.63 24.63 0 014.47-2.393 40.094 40.094 0 015.019-1.708 44.31 44.31 0 015.112-1.06 32.959 32.959 0 014.741-.37c3.934 0 7.399.462 10.415 1.381 3.009.919 5.561 2.244 7.645 3.965 2.091 1.72 3.669 3.761 4.742 6.129 1.073 2.361 1.609 4.988 1.609 7.88v30.404h-25.786c-8.355 0-14.514-1.258-18.473-3.78-3.965-2.521-5.944-6.326-5.944-11.425 0-5.1 1.979-8.904 5.944-11.426 3.959-2.515 10.118-3.78 18.473-3.78h12.899v.007zm-23.492 15.205c0 5.833 3.533 8.756 10.593 8.756h12.899V78.795h-12.899c-7.06-.007-10.593 2.916-10.593 8.749zM151.097 55.759c0-6.018 1.874-10.748 5.623-14.188 3.749-3.44 9.089-5.161 16.032-5.161 2.337 0 4.686.308 7.047.919 2.362.616 4.471 1.38 6.314 2.306l-2.762 5.987c-1.165-.678-2.608-1.307-4.328-1.887a16.475 16.475 0 00-5.346-.876 9.51 9.51 0 00-3.688.734c-1.165.493-2.195 1.246-3.089 2.257-.888 1.011-1.597 2.35-2.121 4.008s-.783 3.625-.783 5.894v.925h14.28v6.45h-14.28v39.616h-12.899V63.127h-8.749v-6.45h8.749v-.918zM163.46 123.522c2.244 0 4.285.284 6.116.845 1.832.561 3.404 1.393 4.717 2.491 1.307 1.098 2.325 2.466 3.052 4.1.722 1.634 1.086 3.527 1.086 5.673s-.364 4.039-1.086 5.673c-.721 1.634-1.738 3.003-3.052 4.1-1.313 1.098-2.879 1.93-4.717 2.491-1.831.561-3.872.845-6.116.845h-12.357v-26.199h12.357v-.019zm-6.925 2.806v20.588h6.925c1.27 0 2.466-.191 3.576-.58a7.486 7.486 0 002.898-1.831c.826-.839 1.48-1.905 1.967-3.2.487-1.295.727-2.855.727-4.68 0-1.819-.246-3.379-.727-4.68-.487-1.295-1.141-2.362-1.967-3.2a7.381 7.381 0 00-2.898-1.831c-1.11-.389-2.3-.58-3.576-.58h-6.925v-.006zm59.884-.931c-1.27 0-2.466.228-3.576.672a7.691 7.691 0 00-2.898 2.059c-.827.925-1.48 2.09-1.967 3.502-.487 1.412-.728 3.077-.728 4.995 0 1.924.247 3.588.728 4.994.487 1.412 1.14 2.578 1.967 3.503a7.75 7.75 0 002.898 2.059c1.11.45 2.3.672 3.576.672 1.27 0 2.466-.222 3.576-.672a7.702 7.702 0 002.898-2.059c.826-.925 1.48-2.091 1.967-3.503.487-1.412.728-3.077.728-4.994 0-1.924-.241-3.589-.728-4.995-.487-1.412-1.141-2.577-1.967-3.502a7.738 7.738 0 00-2.898-2.059c-1.11-.45-2.306-.672-3.576-.672zm0-2.621c2.244 0 4.285.302 6.123.9 1.831.599 3.403 1.486 4.717 2.658 1.307 1.171 2.324 2.62 3.052 4.341.721 1.72 1.085 3.705 1.085 5.95 0 2.244-.364 4.23-1.085 5.95-.722 1.72-1.739 3.169-3.052 4.341-1.314 1.171-2.88 2.059-4.717 2.657-1.832.598-3.873.901-6.123.901-2.244 0-4.292-.303-6.141-.901-1.844-.598-3.422-1.486-4.736-2.657-1.307-1.172-2.318-2.621-3.033-4.341-.71-1.72-1.067-3.706-1.067-5.95 0-2.245.357-4.23 1.067-5.95.709-1.721 1.72-3.17 3.033-4.341 1.314-1.172 2.892-2.059 4.736-2.658 1.849-.604 3.897-.9 6.141-.9zm80.287 24.14v2.805h-21.52v-26.199h5.427v23.394h16.093zm28.443 2.805h-5.426v-26.199h5.426v26.199zm37.619-3.181h.376l9.396-23.018h5.581l-10.667 26.199h-8.99l-10.667-26.199h5.574l9.397 23.018zm51.467-23.018c1.874 0 3.551.204 5.031.617 1.486.413 2.738 1.011 3.761 1.794a7.926 7.926 0 012.356 2.88c.548 1.134.826 2.429.826 3.872 0 1.998-.5 3.681-1.499 5.05-.998 1.375-2.435 2.423-4.303 3.144l6.178 8.836h-6.178l-5.5-7.861H406.188v7.861h-5.426v-26.199h13.473v.006zm-8.047 2.806v12.726h8.047c1.973 0 3.496-.518 4.569-1.554 1.072-1.035 1.609-2.639 1.609-4.809 0-2.17-.537-3.774-1.609-4.809-1.073-1.036-2.596-1.554-4.569-1.554h-8.047zm58.385-.931c-1.27 0-2.466.228-3.576.672a7.691 7.691 0 00-2.898 2.059c-.826.925-1.48 2.09-1.967 3.502-.487 1.412-.727 3.077-.727 4.995 0 1.924.246 3.588.727 4.994.487 1.412 1.141 2.578 1.967 3.503a7.75 7.75 0 002.898 2.059c1.11.45 2.3.672 3.576.672 1.27 0 2.467-.222 3.577-.672a7.718 7.718 0 002.898-2.059c.826-.925 1.479-2.091 1.966-3.503.488-1.412.728-3.077.728-4.994 0-1.924-.24-3.589-.728-4.995-.487-1.412-1.14-2.577-1.966-3.502a7.754 7.754 0 00-2.898-2.059c-1.11-.45-2.3-.672-3.577-.672zm0-2.621c2.245 0 4.286.302 6.123.9 1.831.599 3.404 1.486 4.717 2.658 1.307 1.171 2.325 2.62 3.052 4.341.722 1.72 1.085 3.705 1.085 5.95 0 2.244-.363 4.23-1.085 5.95-.721 1.72-1.739 3.169-3.052 4.341-1.313 1.171-2.879 2.059-4.717 2.657-1.831.598-3.872.901-6.123.901-2.244 0-4.291-.303-6.141-.901-1.844-.598-3.422-1.486-4.735-2.657-1.308-1.172-2.319-2.621-3.034-4.341-.709-1.72-1.067-3.706-1.067-5.95 0-2.245.358-4.23 1.067-5.95.709-1.721 1.72-3.17 3.034-4.341 1.313-1.172 2.891-2.059 4.735-2.658 1.85-.604 3.897-.9 6.141-.9zM220.112 37.71l-7.621 10.779a46.521 46.521 0 00-5.192-.284c-.807 0-1.689.037-2.645.111-.339.025-.678.056-1.029.093l3.286-8.22c4.082-.795 8.583-1.64 13.201-2.478zM83.975 100.967l-14.786 27.266c-7.214 13.3-8.774 12.628-22.697 18.757-8.78 3.866-13.812 6.573-22.58 10.476 2.824-5.531 8.417-13.442 11.993-19.09 3.94-6.228 8.49-13.14 12.32-18.146 5.123-6.697 12.997-9.644 21.278-12.745 2.775-1.036 5.593-2.091 8.164-3.188a42.414 42.414 0 006.308-3.33zM32.273 68.892c-3.724-.055-8.04-1.973-9.785-4.211-1.042-1.338-1.166-2.793.308-4.033L55.488.166 52.108 0 16.613 59.131c-1.795 1.505-2.763 3.41-2.041 5.68-4.366 29.8-9.126 58.421-13.491 88.221-1.092 4.008 4.686 6.956 7.689 6.968l15.205-77.18a24.292 24.292 0 012.176-6.338h.007l.08-.16.117-.21-.006-.006a23.174 23.174 0 014.686-6.147c.4-.37.814-.728 1.24-1.067z" fill="#104F96"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M108.466 19.33L34.209 63.614l79.344-41.466-5.087-2.818zM32.68 60.167l54.267-49.92 5.24 2.103L32.68 60.167zm-5.58.037L65.736 3.182l5.851 1.51L27.1 60.204z" fill="#104F96"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M48.04 96.176c-6.234 2.652-9.496 12.61-11.975 18.35l-13.811 34.166c1.615-2.454 13.725-23.005 22.499-34.474 8.17-10.673 20.57-13.134 32.754-18.32 9.045-3.847 16.37-11.178 20.507-20.513l.247-.555-50.222 21.346z" fill="#F15B25"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M38.476 68.756c-4.217 1.795-7.498 5.001-9.545 8.898l-.074.136c-.03.061-.061.129-.092.19a20.983 20.983 0 00-1.893 5.476L11.98 159.044s23.011-60.636 23.862-62.313c.031-.061.062-.13.093-.19.024-.044.049-.093.074-.136 2.053-3.897 5.327-7.104 9.545-8.898l45.258-19.238c16.062-6.832 29.078-19.854 36.422-36.44l.438-.993-89.197 37.92z" fill="#F15B25"></path></svg>
            </div>
            <div className="form">
                <form onSubmit={onSubmit}>
                    <h1 className="title">Faça Login</h1>
                    { errors && (
                        <div className="alert">
                            {Object.keys(errors).map(key => (
                                <p key={key}>{errors[key][0]}</p>
                            ))}
                        </div>
                    ) }
                    {!loading &&
                        <>
                            <input ref={emailRef} type="email" placeholder="E-mail"/>
                            <input ref={passwordRef} type="password" placeholder="Senha" className="mt-3" />
                            <button type="submit" className="btn btn-block mt-3">Login</button>
                            {/* <p className="message">Não possui uma conta?
                                <Link to="/signup"> Cadastre-se</Link>
                            </p> */}
                        </>
                    }
                    {loading && <p>Logando...</p>}
                </form>
            </div>
        </div>
    );
}